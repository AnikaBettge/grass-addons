<H2>DESCRIPTION</H2>

<p><em>i.landsat.toar</em> is to transform calibrated digital number of Landsat products to top-of-atmosphere radiance or top-of-atmosphere reflectance and temperature (band 6 of the sensors TM and ETM+). Optionally, to calculate the at-surface radiance or reflectance with atmosferic correction (DOS method).</p>

<p>Usually, to do this the production date, the acquisition date, and the solar elevation is needed. Moreover, also is needed for Landsat-7 ETM+ the gain (high or low) of the nine bands.</p>

<p>Optionally, the data can be read from header file (.met) for all Landsat MSS, TM and ETM+. However, if the solar elevation or the product creation date are given the values of metfile are overwriten. This is necessary when this data in metfile are incorrects or imprecisses.</p>

<p><b>Attention</b>: Any null value or less than QCALmin in input raster is set to null in output raster and it is not included in the equations.</p>


<H2>Uncorrected at-sensor values (method=uncorrected, default)</H2>

<p>The standard geometric and radiometric correction results in a calibrated digital number (QCAL = DN) images. To further standardize the impact of illumination geometry, the QCAL images are converted first to at-sensor radiance and then to at-sensor reflectance. The thermal band is first converted from QCAL to at-sensor radiance, and then to effective at-sensor temperature in Kelvin degrees.</p>

<p>Radiometric calibration convert QCAL to <b>at-sensor radiance</b>, a radiometric quantity measured in  W/(m^2 sr um) with the equations:</p>
<ul>
  <li> gain = (Lmax - Lmin) / (QCALmax - QCALmin)</li>
  <li> bias = Lmin - (gain x QCALmin) </li>
  <li> radiance = (gain x  QCAL) + bias </li>
</ul>
<p>where, <em>Lmax</em> and <em>Lmin</em> are the calibration constants, and <em>QCALmax</em> and <em>QCALmin</em> are the highest and the lowest points of the range of rescaled radiance in QCAL.</p>

<p>Then, to calculate <b>at-sensor reflectance</b> the equations are:</p>
<ul>
  <li> sun_radiance = [Esun x sin(e)] / (PI x d^2)</li>
  <li> reflectance = radiance / sun_radiance </li>
</ul>
<p>where, <em>d</em> is the earth-sun distance in astronomical units, <em>e</em> is the solar elevation angle, and <em>Esun</em> is the mean solar exoatmospheric irradiance in W/(m^2 um).</p>


<H2>Corrected at-sensor values (method=corrected)</H2>

<p>At-sensor reflectance values range from zero to one, whereas at-sensor radiance must be greater or equal to zero. However, since Lmin can be a negative number then the at-sensor values also it can be negative. To avoid these possible negative values and set the minimum possible values at-sentor to zero, this method correct the radiance to output a corrected at-sensor values with the equations (not for thermal bands):</p>
<ul>
  <li> radiance = (uncorrected_radiance - Lmin) </li>
  <li> reflectance = radiance / sun_radiance </li>
</ul>

<p><b>Note</b>: Other possibility to avoid negative values is set to zero this values (radiance and/or reflectance), but this option is ease with uncorrected method and r.mapcalc.</p>


<H2>Simplified at-surface values (method=dos[1-4])</H2>

<p>Atmospheric correction and reflectance calibration remove the path radiance, i.e. the stray light from the atmosphere, and the spectral effect of solar illumination. To output these simple <b>at-surface radiance</b> and <b>at-surface reflectance</b>, the equations are (not for thermal bands):</p>
<ul>
  <li> sun_radiance = TAUv [Esun x sin(e) x TAUz + Esky] / (PI x d^2) </li>
  <li> radiance_path = radiance_dark - percent x sun_radiance </li>
  <li> radiance = (at-sensor_radiance - radiance_path) </li>
  <li> reflectance = radiance / sun_radiance </li>
</ul>
<p>where,
<em>percent</em> is a value between 0.0 and 1.0 (usually 0.01),
<em>Esky</em> is the diffuse sky irradiance,
<em>TAUz</em> is the atmospheric transmittance along the path from the sun to the ground surface, and
<em>TAUv</em> is the atmospheric transmittance along the path from the ground surface to the sensor.
<em>radiance_dark</em> is the at-sensor radiance calculated from the darkest object, i.e. DN with a least 'dark_parameter' (usually 1000) pixels for the entire image.</p>

<p>The values are,</p>
<ul>
  <li>DOS1: TAUv = 1.0, TAUz = 1.0 and Esky = 0.0</li>
  <li>DOS2: TAUv = 1.0, Esky = 0.0, and TAUz = sin(e) for all bands with maximum wave length less than 1. (i.e. bands 4-6 MSS, 1-4 TM, and 1-4 ETM+) other bands TAUz = 1.0 (= cos(sat_zenith) in DOS2b)</li>
  <li>DOS3: TAUv = exp[-t/cos(sat_zenith)], TAUz = exp[-t/sin(e)], Esky = rayleigh</li>
  <li>DOS4: TAUv = exp[-t/cos(sat_zenith)], TAUz = exp[-t/sin(e)], Esky = PI x radiance_dark </li>
</ul>

<p><b>Attention</b>: Output radiance remain untouched (i.e. no set to 0. when it is negative) then they are possible negative values. However, output reflectance is set to 0. when is obtained a negative value.</p>


<H2>NOTES</H2>

<p>In verbose mode (flag -v), the program write basic data of satellite and the parameters used in
transformations.</p>

<p>Production date is not a exact value and it is necessary to apply correct calibration constants, which were changed in the dates:</p>
<ul>
  <li>Landsat-1 MSS: never </li>
  <li>Landsat-2 MSS: July 16, 1975</li>
  <li>Landsat-3 MSS: June 1, 1978</li>
  <li>Landsat-4 MSS: August 26, 1982 and April 1, 1983</li>
  <li>Landsat-4 TM:  August 1, 1983 and January 15, 1984</li>
  <li>Landsat-5 MSS: April 6, 1984 and November 9, 1984</li>
  <li>Landsat-5 TM:  May 4, 2003 and April, 2 2007</li>
  <li>Landsat-7 ETM+: July 1, 2000</li>
</ul>


<H2>EXAMPLES</H2>

<p>Transform digital numbers of Landsat-7 ETM+ in band rasters 203_30.1, 203_30.2[...] to uncorrected at-sensor reflectance in output files 203_30.toar.1, 203_30.toar.2 [...] and at-sensor temperature in output files 203_30.toar.61 and 203_30.toar.62:</p>

<div class="code"><pre>i.landsat.toar -7 band=203_30 met=p203r030_7x20010620.met</pre></div>

<p>or</p>

<div class="code"><pre>i.landsat.toar -7 band=203_30 product=2004-06-07 date=2001-06-20 solar=64.3242970 gain="HHHLHLHHL"</pre></div>

<H2>REFERENCES</H2>
<ol>
  <li>Chander G.H. and B. Markham: IEEE Transactions On Geoscience And Remote Sensing, vol. 41, no. 11, November 2003.</li>
  <li>Chavez P.S., jr. 1996. Image-based atmospheric corrections - Revisited and Improved. Photogrammetric Engineering and Remote Sensing 62 (9): 1025-1036.</li>
  <li>Huang et al: At-Satellite Reflectance: A First Order Normalization Of Landsat 7 ETM+ Images. 2002.</li>
  <li>R. Irish: <a href="http://ltpwww.gsfc.nasa.gov/IAS/handbook/handbook_toc.html">Landsat 7. Science Data Users Handbook. February 17, 2007.</a></li>
  <li>Markham B.L. and J.L. Barker: Landsat MSS and TM Post-Calibration Dynamic Ranges, Exoatmospheric Reflectances and At-Satellite Temperatures. EOSAT Landsat Technical Notes, No. 1, 1986</li>
  <li>Moran M.S., R.D. Jackson, P.N. Slater and P.M. Teillet: Remote Sensing of Environment, vol. 41. 1992.</li>
  <li> Song et al : Classification and Change Detection Using Landsat TM Data: When and How to Correct Atmospheric Effects?. Remote Sensing of Environment, vol. 75. 2001. </li>
</ol>


<H2>SEE ALSO</H2>

<p><em>
    <a HREF="r.mapcalc.html">r.mapcalc</a><br>
    <a HREF="r.in.gdal.html">r.in.gdal</a><br>
</em></p>


<H2>AUTHOR</H2>

<p>E. Jorge Tizado  (ej.tizado unileon es)<br>
Dept. Biodiversity and Environmental Management, University of Leon, Spain<br></p>

<p><i>Last changed: $Date: 2009/01/090 00:00:00 $</i></p>

