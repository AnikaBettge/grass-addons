<!-- <h2>DESCRIPTION</h2> -->

<em>v.civil.road</em> generates a alignment for design roads, channels
and ports.
<p>
Applications:

<ul>
	<li>Roads, streets, railroads, walls,...</li>
	<li>Channels, reservoirs, supply and waste water conduction,  ...</li>
	<li>Ports, </li>
</ul>

<h2>USAGE</h2>

To run the program for the first time, a map with one horizontal polygon, is
required. If a table exist in layer 1, this will no be overwritten. This layer
is for store information about the road by the user.

<p>
There are three options for run the program, Create/Update polygon, Update
solution and Insert point in the central axis.


<p>
The flag <em>-n</em>  (Create/Update new polygon), four tables will be add to
the polygon map, where the parameter of the road will be stored. This
flag must be selected for create a new polygon for the first time or if the
vertices/nodes of the polygon are moved or added another ones.

<p>
The flag <em>-u</em> "Update solution" will write the selected maps, with the
parameters included in the tables of the polygon.

<p>
The name of the outs maps, are given by default. If the out name map is
preceded with character "_", this name will be added to the polygon name map.
This is useful for change of axis quickly.

<p>
The <em>-i</em> flag (Insert points), new points for defining the road,
can be added to the layers _Vertical, _Section and _Trans, referencing by pk.

<p>
The user must select the layer and give a list with the pks.

<p>
The <em>Interval in straights</em> and <em>Interval in curves</em> options
define the resolution of the straight lines and the curves respectively.


<p>
The other options are described below.


<h3>Plan</h3>

<p>
The <em>-y</em> flag write a 3D central axis (contains the plant and vertical
alignment), with the name in <em>plantpoly</em> option (default:
<em>NameRoad</em>_poly).

<p>
The <em>-h</em> flag write the horizontal alignment, with the name
in <em>plant</em> option. The map created, contains the segments of the
alignment and its information is stored in three tables/layers.
(default: <em>NameRoad</em>_plan).

<p>
The <em>-k</em> flag write pk marks in horizontal, with the name in
<em>pks</em> option.(default: <em>NameRoad</em>_Pks).

<p>
The <em>pkopt</em> option define the distance between normal marks (npk),
distance between principal marks (mpk), longitude of normal marks and
longitude of principal marks.

<p>
The <em>-d</em> flag write the displaced platform lines in horizontal,
with the name in <em>displ</em> option.

<p>
The <em>-a</em> flag write an area map with displaced platform lines in
horizontal, with the name in <em>displ_area</em> option.



<h3>Vertical</h3>

<p>
The <em>-v</em> flag write the vertical alignment in horizontal, with the name
in <em>raised</em> option. The map created, contains the segments of the
alignment and its information is stored in three tables.(default:
<em>NameRoad</em>_Vert)

<p>
The <em>-l</em> flag write the raised of the central axis (vertical alignment),
the
terrain profile in a longitudinal profile map, and vertical polygon with the
names given in <em>LPras</em> ,<em>LPterrain</em> and <em>LPejeref</em> options
(default: <em>NameRoad</em>_LP_Ras, <em>NameRoad</em>_LP_terrain and
<em>NameRoad</em>_LP_Polygon).

<p>
The <em>-m</em> flag write the coordinates axis and the profile guitar in the
longitudinal profile with its marks, with the names given in <em>LPaxisX</em>,
<em>LPaxisX_marks</em>, <em>LPaxisY</em> and <em>LPaxisY_marks</em> options
(default: <em>NameRoad</em>_LP_AxisX, <em>NameRoad</em>_LP_AxisXmarks,
<em>NameRoad</em>_LP_AxisY and <em>NameRoad</em>_LP_AxisYmarks).

<p>
With the option <em>LPScale</em>, the vertical scale of the longitudinal
profile can be given.

<p>
The <em>LPopt</em> option give the longitude of marks, distance between marks
in axis x and y, and distance between lines of the guitar.


<h3>Cross</h3>

<p>
The <em>-c</em> flag write the projection of cross section in horizontal, with
the name in <em>cross</em> option, and with the lines selected in
<em>cross_opt</em> option.

<p>
The <em>-r</em> flag write a map with points of intersection of displaced lines
with cross-section lines, in horizontal, with the name in <em>crossdispl</em>
option. The lines that will be crossed are selected in <em>displ_opt</em>


<p>
The <em>-f</em> flag write the raised of cross-section (cross alignment) and the
terrain profile in a traversal profile map with the names given in
<em>LTras</em> and <em>LTterrain</em> options (default: <em>NameRoad</em>_TP_Ras
and <em>NameRoad</em>_TP_terrain

<p>
The <em>-m</em> flag write the coordinates axis and the profile guitar in the
longitudinal profile with its marks, with the names given in <em>LTaxisX</em>
and <em>LTaxisY</em> options (default: <em>NameRoad</em>_TP_AxisX and
<em>NameRoad</em>_TP_AxisY ).

<p>
With the option <em>LTScale</em>, the vertical scale of the longitudinal
profile can be given.

<p>
The <em>LTopt</em> option give the longitude of marks, distance between marks
in axis x and y, and distance between lines of the guitar.

<p>
The <em>LTopt2</em> option give the number of rows of cross-section to display,
distance between cross-section in axis x and y.


<h3>Terrain</h3>


<p>
The <em>-t</em> flag write the Dem profile of the central axis, with the name
in <em>outtlong</em> option.

<p>
The <em>-q</em> flag write the projection of transects lines on a DEM (3D lines
of terrain) in horizontal, with the name in <em>outtcross</em> option.

<p>
The <em>-s</em> flag write the slope soil lines calculated with the last
displaced lines (perpendicular to the central axis), with the name
in <em>outslope</em> option

<p>
The <em>-e</em> flag write the areas map with slope soil lines and the last
displaced lines in horizontal, with the name in <em>outslopeareas</em> option

<p>
The <em>-p</em> flag write a 3D points map of lines selected in
<em>pts_opt</em> option
in horizontal, with the name in <em>outpoints</em> option

<p>
The <em>-b</em> flag write a 3D lines map of lines selected in
<em>break_opt</em> option in horizontal, with the name in <em>outbreak</em>
option

<p>
The <em>-o</em> flag write a hull area map of lines selected in
<em>hull_opt</em> option in horizontal, with the name in <em>outhull</em> option


<h2>Tables</h2>

<p>
Geometric roadway design can be broken into four main parts: horizontal
alignment, profile (vertical alignment), platforms definition and cross-section.

<p>
There are maps in horizontal alignment for display in plan, maps in vertical
alignment that requires a new display for visualization in profile view, and
maps in cross-section that requires a new display for visualization in profile
cross-section view.

<p>
The tables stored in the polygon map are:

<h3>Layer 1:</h3>
<p>
Created with only cat column (if not exist), is for free use to add columns
with information of the road.



<h3>Layer 2:</h3>
<p>
<b>"NameRoad"_Horizontal</b>, for insert the parameters of the horizontal
alignment. This layer have all vertices and nodes of the horizontal polygon.
No more points can be added to this layer with the insert point option.

<p>
The columns are:

<ul>
    <li><b>radio</b>: radio of curve
	<p>+ for clockwise</p>
	<p>- for anticlockwise</p>
    </li>
    <li><b>a_in</b>: Parameter A of input Clothoid</li>
    <li><b>a_out</b>: Parameter A of output Clothoid</li>
    <li><b>widening</b>: Widening of curve (where this widening is growing
	in the clothoid, only in mode exact)</li>
</ul>



<h3>Layer 3:</h3>

<p>
<b>"NameRoad"_Vertical</b>, for insert the parameters of the vertical
alignment.This layer are created with the first an last vertices of the
horizontal polygon. New point can be added by the flag i (Insert point),
or with edit gui. The added points, are inserted in the central axis
referencing by pk.

<p>
The columns are:

<ul>
    <li><b>pk</b>: kilometric point of the central axis</li>
    <li><b>elev</b>: Elevation of the vertice of the vertical alignment</li>
    <li><b>kv</b>: Parameter Kv of the vertical alignment</li>
    <li><b>l</b>: Leng of parabolic curve (no yet implemented)</li>
    <li><b>B</b>: Height of vertice of vertical polygon to the parabolic
		curve (no yet implemented)</li>
</ul>


<h3>Layer 4: </h3>

<b>"NameRoad"_Section</b>, for insert the parameters of the platform.
This layer are created with the first an last vertices of the horizontal
polygon. New point can be added by the flag i (Insert point), or with edit
gui. The added points, are inserted in the central axis referencing by pk.
<p>
The columns for editing by the user are:

<ul>
    <li><b>pk</b>: kilometric point of the central axis</li>
    <li><b>sec_left, sec_right</b>: For defining left and right platform lines
        (distance and height to the central axis), separated by ";" </li>
    <li><b>type_left, type_right</b>: Types of left and right lines
        (types are: l,e,r,0). You can enter the type of multiple lines
        separated by ";"
	<b>l</b>: linear approximation between definition points.
	<b>e</b>: displaced lines, mode exact.
	<b>c</b>: ellipse between definition points.
	<b>rR,A</b>: circle between definition points ((x-A)^2+y^2=R^2))</li>

    <li><b>cut_left, cut_right</b>: Cut slope left and right </li>
    <li><b>fill_left, fill_right</b>: Fill slope left and right </li>
</ul>

<p>
Between two points, if the second input distance equal zero, the line will be
stopped. If the second input distance equal -1, this point will not be processed
and the next one will be considered.



<h3>Layer 5:</h3>
<p>
<b>"NameRoad"_Trans</b>, for insert the parameters of transects to the central
axis.
This layer are created with the first an last vertices of the horizontal
polygon. New point can be added by the flag i (Insert point), or with edit gui.
The added points, are inserted in the central axis referencing by pk.
<p>
The columns for editing by the user are:

<ul>
    <li><b>pk</b>: kilometric point of the central axis</li>
    <li><b>dist_left,dist_right</b>: Distance left and right from the central
axis</li>
    <li><b>npk</b>: Distance between trans</li>
</ul>




<h2>Example</h2>
<p>
First we are going to create a polygon with wxdigit, this will create a table in
layer 1. The name of this map is road1. The polygon will have three lines,two
vertices and two nodes. In this layer we can create, for example, with the
command <em>v.db.addcolumn</em>, three new columns to store our information
about the road. This columns are <em>Name, Cod, Date</em>.

<p>
At this point we can give the name and select the flag <em>-n</em> (Create/Update
polygon) and then run. Four tables are crated (or five if the table in layer 1
don't exist).

<p>
<img src="vcivilroad_1.png" width="600" height="350" alt="" >




<h3>Plant</h3>

<p>
The second one, in layer 2, is the definition of the road in plant. This table
have four rows, the first and the last are the vertices of the polygon and the
other are the nodes of the polygon.

<p>
<img src="vcivilroad_2.png" width="700" height="300" alt="" >

<p>
In this table we can define the radio, the parameter A of the input and output
clothoid, widening (applied to the displaced lines, see below) in curves and
superelevation (applied to the displaced lines, TODO) for each node.

<p>
After that, in the tab Plant, we can select the flag <em>-h</em> to write the horizontal
alignment and the flag <em>-k</em> to write the pk's marks. At this moment we need to
update the solution with the flag <em>-u</em> and then run.

<p>
<img src="vcivilroad_3.png" width="700" height="300" alt="" >

<p>
Then we get two maps <em>road1_plant</em> and <em>road1_pks</em>. The
<em>road1_plant</em> has three tables with the parameters of the horizontal
alignment. The <em>road1_pks</em> has a table with a pk columns to use with
labels.

<p>
<img src="vcivilroad_4.png" width="800" height="450" alt="" >

<p>
At any time we can move the vertices/nodes or add new ones to the polygon, for
example, wxdigit. If we do that, we need to select the flag <em>-n</em> to update the
polygon and the flag <em>-u</em> to update the solution again.

<p>
The polylines that you can see in the last figure have a distance between
points about 1 meters by default, but this can be changed in the <em>Interval
in straights</em> and <em>Interval in curves</em> options (see below).

<p>
An example of this section can be seen in
http://www.youtube.com/watch?v=n2JYfgVDcmY<br>
(You can activate HD quality for better visualization)




<h3>Vertical</h3>

<p>
The third table, in layer 3, is where the vertical alignment is stored. When
this table is created, have two rows, who are the first and the last points of
the central axis, and for that, the vertices of the new polygon of the vertical
alignment.

<p>
In this table we can insert breakpoints or new nodes to the vertical polygon to
define new vertical alignments, with the option <em>-i</em>, selecting the layer
<em>Vertical</em> and giving a list of pks where the breakpoints will be
inserted in the central axis. In the columns we can define the elevation,
the parameter <em>kv</em> and the pk of each node.

<p>
<img src="vcivilroad_8.png" width="700" height="300" alt="" >

<p>
After that, in the tab <em>Vertical</em>, we can select the flag <em>-v</em> to write the
vertical alignment in plant. The map that we get is <em>road1_Vert</em>. It has
two tables with the parameters of the vertical alignment.

<p>
The flag <em>-l</em> draw the longitudinal profile of the central axis of the
road and the terrain profile. The <em>road1_LP_Ras</em> has two tables with the
parameters of the vertical alignment.

<p>
The flag <em>-m</em> draw the coordinates axes of the longitudinal profile. Those maps
have tables with columns for use with labels.

<p>
We need to give a dem in the terrain tabs, select the flag <em>-u</em> for update the
solution and then run, to obtain those maps.

<p>
<img src="vcivilroad_9.png" width="800" height="450" alt="" >

<p>
An example of this section can be seen in
http://www.youtube.com/watch?v=AuKYSxohLKE<br>
(You can activate HD quality for better visualization)




<h3>Platform lines</h3>

<p>
The fourth table, in layer 4, is the definition of the platforms lines in plant.
For first time, this table have two rows, who are the vertices of the polygon,
and for that the first and the last points of the central axis.

<p>
The displaced lines are defined in <em>sec_left,sec_right</em> columns with
a list separated with ";", starting from left to right in each side of the
central axis. Each displaced line is defined with distance to the central
axis and height to the central axis (d,h).

<p>
The mode to calculate the displaced lines is defined in the
<em>type_left,type_right</em> columns,for each line separated by ";".

<p>
In this table we can insert breakpoints for the displaced lines with the option
 <em>-i</em>, selecting the layer <em>Section</em> and giving a list of pks where the
breakpoints will be inserted in the central axis. In this example we are going
to insert some breakpoints and define three displaced lines in the left side to
the central axis and three for right side.

<p>
<img src="vcivilroad_5.png" width="700" height="300" alt="" >

<p>
The platform lines define, the lanes of a road, the platform limits, ... Those
lines can be parallel to the central axis of a road (or not). If it's so, we
need to know that the parallel to a clothoid is not a clothoid. Then we have two
ways to do the platform lines.

<p>
In the first way, mode exact "e", we need to calculate a new displaced central
axis, e.i., a parallel to the polygon not to the central axis. The new alignment
or displaced line created within the new polygon have new clothoids for the
transitions. To run this mode, the first and the last points, of a section of
the road, must have the same displaced distance.

<p>
The widening parameter of the section above, only will be calculate in this
mode, because the widening growing in the clothoid, then is applied only to the
displaced lines calculated with clothoid.

<p>
The second way, mode lineal "l", we calculate the perpendicular displaced
distance to each point of the central axis, to obtain a parallel to it,
where the transitions won't be clothoids. Then we can't know where are
the tangents of transitions. But in this mode, the displaced distance for the
first and the last points don't have to be the same in a section of the road.
A lineal variation will be done between those points.

<p>
For this example, the first and last are defined as lineal and the rest are in
mode exact.

<p>
Into this second way, the variation don't have to be only lineal. We can define
a circumference in the displaced line with the option "rR,A".

<p>
Between two points, if the second input distance equal zero, the line will be
stopped. If the second input distance equal -1, this point will not be processed
and the next one will be considered.

<p>
After that, in the tab <em>Plant</em>, we can select the flag <em>-d</em> to write the
displaced lines map. At this moment we need to update the solution with the flag
-u and then run.

<p>
Then we get a map <em>road1_Displ</em>. This map has two tables, the first has
the displaced lines and the second has the characteristic points of the lines if
the mode "e" has been used.


<p>
<img src="vcivilroad_6.png" width="800" height="450" alt="" >

<p>
With the height of the lines we can obtain different forms, that we'll see in
the cross sections.

<p>
<img src="vcivilroad_7.png" width="600" height="300" alt="" >

<p>
The cut/fill are calculated with the first displaced line of the left side and
the last displaced line of the right side, and with the slope given in the
columns <em>cut_left, cut_right, fill_left, fill_right</em>

<p>
An example of this section can be seen in
http://www.youtube.com/watch?v=3tYxD8HsDEA<br>
(You can activate HD quality for better visualization)




<h3>Cross sections</h3>

<p>
The fifth table, in layer 5, is the table where we are going to define
transversals 2D lines to the central axis, to obtain later, the cross sections.

<p>
This lines contains the cutoff with the displaced lines.

<p>
When this table is created, have two rows, who are the first and the last points of
the central axis.

<p>
In this table we can insert breakpoints for the transversals lines with the option
 <em>-i</em>, selecting the layer <em>Trans</em> and giving a list of pks where the
breakpoints will be inserted in the central axis. In this example we are going
to insert some breakpoints to define different transversals lines.

<p>
In the columns <em>dist_left, dist_right</em> we can define the distance left
and right to the central axis and in the column npk the distance between lines.

<p>
<img src="vcivilroad_10.png" width="700" height="325" alt="" >

<p>
Then, in the tab <em>Cross</em>, we can select the flag <em>-c</em> to write the
transversals lines in plant. The map that we get is <em>road1_Cross</em>. It has
a table with some parameters.

<p>
In the tab <em>Terr</em>, we can select the flag <em>-s</em> to write the
cut/fill lines in plant, with the slope given in the table <em>road1_Section</em>.
The map that we get is <em>road1_Slope</em>.

<p>
<img src="vcivilroad_11.png" width="700" height="300" alt="" >

<p>
In the tab <em>Cross</em> again, we can select the flag<em>-f</em> to draw the
cross sections and the terrain profile. The maps that we get are
<em>road1_TP_Ras</em>, that It has two tables with some parameters, and
<em>road1_TP_Terr</em>

<p>
<img src="vcivilroad_12.png" width="700" height="450" alt="" >

<p>
The flag <em>-g</em> draw the coordinates axes of the cross sections. Those maps
have tables with columns for use with labels. It can be a bit slow.

<p>
<img src="vcivilroad_13.png" width="500" height="250" alt="" >

<p>
We need to give a dem in the terrain tabs, select the flag<em>-u</em> for update the
solution and then run, to obtain those maps.

<p>
An example of this section can be seen in
http://www.youtube.com/watch?v=w2LGurDfbY0<br>
(You can activate HD quality for better visualization)




<h3>Terrain</h3>

<p>
Some lines before, we have seen who to write the cut/fill lines in plant, with
the slope given in the table <em>road1_Section</em>.

<p>
Now we have defined the road, then we can generate points of the different alignments,
breaklines and a hull of all points, with the flags <em>-p</em>, <em>-b</em> and <em>-o</em>.

<p>
The distance between points of each alignments is of 1 meters by default, but
this can be changed in the <em>Interval in straights</em> and
<em>Interval in curves</em> options. The result can be seen below.

<p>
<img src="vcivilroad_14.png" width="700" height="550" alt="" >

<p>
This three maps, created <em>road1_Points, road1_Breaklines and road1_Hull</em> can
be used in <em>v.civil.topo</em> for get the triangulation of the road.

<p>
An example of this section can be seen in
http://www.youtube.com/watch?v=uFZ1PPxkE1c<br>
(You can activate HD quality for better visualization)

<p>
To build another types of alignments like "curve-clothoid-curve", or roundabout
see <em>v.civil.tools</em>



<h2> AUTHOR</h2>
<p>
Jesus Fernandez-Capel Rosillo<br >
Civil Engineer, Spain<br >
jfc at alcd net<br >


<p>
<i>Last changed: $Date: 2014-03-18 03:16:51 +0100 (mar 18 de mar de 2014)$</i>
