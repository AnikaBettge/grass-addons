<h2>DESCRIPTION</h2>

<em>r.hants</em> performs a harmonic analysis of time series in order to 
estimate missing values and identify outliers. For each input map, an 
output map with the suffix <em>suffix</em> (default: _hants) is created.

<p>
The option <b>nf</b>, number of frequencies, should be carefully chosen. 
Different numbers of frequencies should be tested first on a small test 
region before running the module on the full region. As a rule of thumb, 
the number of frequencies should be at least 
<em>estimated periodicity + 3</em>, e.g. for NDVI with an annual cycle 
(one peak per year), the number of frequencies should be at least 4 when 
analysing one year. If two peaks are assumed per year, the number of 
frequencies should be at least 5 when analysing one year.

<p>The number of frequencies should also not be too large. With a large 
number of frequencies, outliers can not longer be identified because the 
fit is &quot;too good&quot;, outliers can be represented by the estimate. 
The number of frequencies should also be smaller than <em>n input maps / 2</em>
if missing values should be reconstructed.


<h2>NOTES</h2>

<p>
If the <em>range=</em> option is given, any values which fall outside
that range will be treated as if they were NULL.
The <em>range</em> parameter can be set to <em>low,high</em> thresholds:
values outside of this range are treated as NULL.

<p>
The <em>low,high</em> thresholds are floating point, so use <em>-inf</em> or
<em>inf</em> for a single threshold (e.g., <em>range=0,inf</em> to ignore
negative values, or <em>range=-inf,-200.4</em> to ignore values above -200.4).

<p>
The number of raster maps to be processed is given by the limit of the
operating system. For example, both the hard and soft limits for users are
typically 1024. The soft limit can be changed with e.g. <tt>ulimit -n
1500</tt> (UNIX-based operating systems) but not higher than the hard
limit. If it is too low, you can as superuser add an entry in

<div class="code"><pre>
/etc/security/limits.conf
# &lt;domain&gt;      &lt;type&gt;  &lt;item&gt;         &lt;value&gt;
your_username  hard    nofile          1500
</pre></div>

This would raise the hard limit to 1500 file. Be warned that more
files open need more RAM. Also have a look at the system-wide limit
<div class="code"><pre>
cat /proc/sys/fs/file-max
</pre></div>
which is on modern systems several 100,000 files.


<p>Use the <em>file</em> option to analyze large amount of raster maps 
without hitting open files limit and the size limit of command line 
arguments. The computation is slower than the <em>input</em> option 
method. For every single row in the output map(s) all input maps are 
opened and closed. The amount of RAM will rise linear with the number of 
specified input maps. The input and file options are mutually exclusive.
Input is a text file with a new line separated list of raster map names 
and optional weights. As separator between the map name and the weight 
the charachter | must be used.

<h2>EXAMPLE</h2>

This small example is based on a climate dataset for North Carolina which
was from publicly available data (monthly temperature averages and monthly
precipitation sums from 2000 to 2012, downloadable as
<a href="http://courses.ncsu.edu/mea592/common/media/02/nc_climate_spm_2000_2012.zip">GRASS GIS 7 location</a>):


<div class="code"><pre>
# set computational region to one of the maps
g.region rast=2004_03_tempmean -p
</pre></div>

Visualize the time series as animation:
<div class="code"><pre>
# note: color table is different from standard "celsius"
g.gui.animation rast=`g.mlist rast pattern="*tempmean" sep=comma`
</pre></div>

<p>
Since HANTS is CPU intensive, we test at lower resolution:
<div class="code"><pre>
g.region -p res=5000

# HANTS: Harmonic analysis of the 156 input maps...
# just wildly guessing the parameters for a test run:
r.hants input=`g.mlist rast pattern=20??_??_tempmean sep=comma` \
  nf=6 fet=0.1 dod=5 delta=0.1 base_period=12

# assign reasonable color tables for temperature
for map in `g.mlist rast pattern="*tempmean_hants"` ; do
    r.colors $map color=celsius
done

# verify with one of the 156 results (still at reduced resolution):
r.mapcalc "2000_06_tempmean_diff = 2000_06_tempmean - 2000_06_tempmean_hants"

r.colors 2000_06_tempmean_diff color=differences
d.mon wx0
d.rast 2000_06_tempmean_diff

r.univar 2000_06_tempmean_diff -g
n=5066
null_cells=5040
cells=10106
min=-0.0899336115228095
max=0.359362050140941
range=0.449295661663751
mean=0.188579838052468
...

# see HANTS time series as animation
g.gui.animation rast=`g.mlist rast pattern="*tempmean_hants" sep=comma`
</pre></div>


<h2>REFERENCES</h2>
<p>
Roerink, G. J., Menenti, M. and Verhoef, W., 2000. Reconstructing 
cloudfree NDVI composites using Fourier analysis of time series. 
International Journal of Remote Sensing, 21 (9), 1911-1917. 
DOI: <a href=http://dx.doi.org/10.1080/014311600209814>10.1080/014311600209814</a>

<h2>AUTHOR</h2>

Markus Metz

<p><i>Last changed: $Date$</i>
