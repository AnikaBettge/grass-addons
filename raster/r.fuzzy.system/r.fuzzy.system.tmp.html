<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>GRASS GIS manual: r.fuzzy.system</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="grassdocs.css" type="text/css">
</head>
<body bgcolor="white">

<img src="grass_logo.png" alt="GRASS logo"><hr align=center size=6 noshade>

<h2>NAME</h2>
<em><b>r.fuzzy.system</b></em> <h2>KEYWORDS</h2>
<h2>SYNOPSIS</h2>
<b>r.fuzzy.system</b><br>
<b>r.fuzzy.system help</b><br>
<b>r.fuzzy.system</b> [-<b>m</b>]  [<b>maps</b>=<em>name</em>]   [<b>rules</b>=<em>name</em>]  <b>family</b>=<em>string</em> <b>defuz</b>=<em>string</em> <b>imp</b>=<em>string</em> <b>res</b>=<em>integer</em>  [<b>coors</b>=<em>x,y</em>]  <b>output</b>=<em>name</em>  [--<b>overwrite</b>]  [--<b>verbose</b>]  [--<b>quiet</b>] 

<h3>Flags:</h3>
<DL>
<DT><b>-m</b></DT>
<DD>Create addational fuzzy output maps for every rule</DD>

<DT><b>--overwrite</b></DT>
<DD>Allow output files to overwrite existing files</DD>
<DT><b>--verbose</b></DT>
<DD>Verbose module output</DD>
<DT><b>--quiet</b></DT>
<DD>Quiet module output</DD>
</DL>

<h3>Parameters:</h3>
<DL>
<DT><b>maps</b>=<em>name</em></DT>
<DD>Name of fuzzy variable file</DD>

<DT><b>rules</b>=<em>name</em></DT>
<DD>Name of rules file</DD>

<DT><b>family</b>=<em>string</em></DT>
<DD>Fuzzy logic family</DD>
<DD>Options: <em>Zadeh,product,drastic,Lukasiewicz,Fodor,Hamacher</em></DD>
<DD>Default: <em>Zadeh</em></DD>

<DT><b>defuz</b>=<em>string</em></DT>
<DD>Defuzzyfication method</DD>
<DD>Options: <em>centeroid,bisector,min,max,mean</em></DD>
<DD>Default: <em>bisector</em></DD>

<DT><b>imp</b>=<em>string</em></DT>
<DD>Implication method</DD>
<DD>Options: <em>minimum, product</em></DD>
<DD>Default: <em>minimum</em></DD>

<DT><b>res</b>=<em>integer</em></DT>
<DD>Universe resolution</DD>
<DD>Default: <em>100</em></DD>

<DT><b>coors</b>=<em>x,y</em></DT>
<DD>Coordinate of cell for witch output  detail data</DD>

<DT><b>output</b>=<em>name</em></DT>
<DD>Name of output file</DD>

</DL>
<h2>OPTIONS</h2>

<p>
<DT><b>maps</b></DT>
<DD>A text file containing maps name and and connected with map fuzzy sets definition. Maps in text file must exist in a search path, except the output map. The name oof output map must be identical with that output name parameter. If maps are teken from different mapsets the name require @. Map names in database cannot contain following symbols: <B> %,$ and #</B>. Every map name must start with map name identifier:<B> %</B>. Every set definition connected with cetrain map must follow the map name and must start with set identifier :<B> $</B>, and naturally finish with EOL. The set definition must be in braces { } and requires parameters separated by semicolon. Any whitespaces like spaces, tabs, empty lines are allowed and may used to visual format of rule file.

<PRE>$ set_name {side; points; boundary_shape; hedge; height }</PRE>
<UL>
<li><B>set_name</B>: Any name of fuzzy set. Must not contain symbols: <i> %,$ and #</i>
<li><B>side</B>: Option indicat if set is fuzzified ob both side s (both), left or right side. See description for details. Available: <i>both, left, right</i>. 
<li><B>points</B>: A list containing 4 (A,B,C,D) or 2 A,B) points searated by comma. defining set boundaries. Points must not to be in map range, but it may lead to only 0 o 1 membership for the whole map. For "both" side parameters range between A and D defines base, but range between B and C core of the fuzzy set. Between A and B and C and D are set's boundaries. If side is "both" it require 4 points, else 2 points.
<li><B>shape</B>: Parameter definied the shape of the fuzzy boundary. Available: <i>sshaped, linear, jshaped, gshaped</i>. The same boundaires are appled to  both sides of fuzzy set.
<li><B>hedge</B>: Shape modifier the positive number means dilatation (power of fuzzy set by 2) the negative means concetration (square root of fuzzy set). The number means number of dilatation/concetration applied on fuzzy set.
<li><B>height</B>: Height modifier. Range from 0 to 1. The  value 1 and indicate full membership beteen points B and C. If height is lesser than one the maximum memebrship is equal to height.
</UL>
<h3>An example of fuzzy sets definiton for elev map:</h3>
<PRE>
  %elev
$ low {right; 60,100; sshaped; 0; 1}
$ moderate {both; 90,100,120,130; sshaped; 0; 1}
$ high {left; 120,130; sshaped; 0; 1}
</PRE>

<center>
<h3>Fuzzy set definition:<h3>
<img src=set.png border=1><br>
</center>
</DD>
<p>
<H3>Special notes about output fuzzy set definition</H3>

<DT><b>rules</b></DT>
<DD>A text file containing rules for classification.Th typical fuzzy rule consists of antecedents and consequent:

<PRE>IF elev IS high AND wetness IS low THEN probability IS small</PRE>

Because module creates only one result map, the consequent map name is ommited. Every rule starts with $ and consist of consequent name and antecedents in braces { }. All maps and sets used in atecednats must be included in the maps file. At the begining of the calculation program checks if all names and sets are included in maps file. Names of the consequents must be same as sets names of the output map. The rules file use following symbology:
<UL>
<li>IS is symbolised by <B>=</B>
<li>IS NOT is symbolised by <B>~</B>
<li>AND is symbolised by <B>&</B>
<li>OR is symbolised by <B>|</B>
</UL>
<P>
To  specify the order of operators must use parentheses. Optional number at the end of the  rule symbolize weight of the rule (curently not in use).

<h3>An example of fuzzy rules definiton file:</h3>
<PRE>
#This is example of fuzzy rules definition for flood probablity .
$ small {distance = high & elev = high} 1;
$ medium {distance = low | (elev = low & distance ~ low) };
$ high {distance = low & elev = low};
</PRE>

<h2>ADVANCED OPTIONS</h2>
In most cases default options shoud not be changed.
<DT><b>family</b></DT>
<DD>AND and OR operations in fuzzy logic are made with T-norms, T-conorms. T-norms, T-conorms are a generalization of the two-valued logical conjunction and  disjunction  used by boolean logic, for fuzzy logics. Because there is more than one possible generalisation of logial operations, r.fuzzy.system provides 6 most popular families for fuzzy operations:
<ul>
<li><b>Zadeh</b> with minimum (Godel) t-norm and maximum T-conorm;
<li><b>product</b> with product T-norm and probabilistic sum as T-conorm;
<li><b>drastic</b> with drastic T-norm and drastic T-conorm;
<li><b>Lukasiewicz</b> with Lukasiewicz T-norm and bounded sum as a T-conorm;
<li><b>Fodor</b> with nilpotent minimum as T-norm and nilpotent maximum as T-conorm;
<li><b>Hamacher</b> (simplified) with Hamacher product as T-norm and Einstein sum as T-conorm;
</ul>
<P>
<TABLE cellspacing=4>
<TR><TH>Family</TH><TH> T-NORM (AND) </TH><TH>T CONORM (OR) </TH></TR>
<TR><TD>ZADEH</TD><TD> MIN(x,y)</TD><TD>MAX(x,y)</TD></TR>
<TR><TD>PRODUCT</TD><TD>	x*y	</TD><TD>x + y -x * y</TD></TR>
<TR><TD>DRASTIC	</TD><TD>IF MAX(x, y) == 1 THEN MIN(x, y) ELSE 0	</TD><TD>IF (MIN(x, y) == 0) THEN MAX(x, y) ELSE 1</TD></TR>
<TR><TD>LUKASIEWICZ</TD><TD>	MAX((x+y-1),0)</TD><TD>	MIN((x+y),1)</TD></TR>
<TR><TD>FODOR	</TD><TD>IF (x+y)>1 THEN MIN(x,y) ELSE 0	</TD><TD>IF (x+y<1) THEN MAX(x,y) ELSE 1</TD></TR>
<TR><TD>HAMACHER</TD><TD>	IF (x==y==0) THEN 0 ELSE (x*y)/((x+y)-x*y)</TD><TD>	(x+y)/(1+x*y)</TD></TR>
</TABLE>
<P>
<DT><b>implication</b></DT>
<DD>Imlication determines the transition between antecedents and consequents: 
<UL>
<li><B>minimum</B> means the lowest value of the antecedtents and output set definition. It ussually creates trapezoidal consequent set definition.
<li><B>product</B> means the multiplication of the antecedtents and output set definition. It ussually creates triangular consequent set definition.
</UL>

<DT><b>defuzzification</b></DT>
<DD>Defuzzification is the process of conversion of fuzzy set into one crisp value. Before deffuzification all consequents are agregated into one fuzzy set. The r.fuzzy.system provides 5 methods of deffuzyfication:
<UL>
<li><B>centeroid</B> center of mass of the fuzzy set (in practise weighted mean);
<li><B>bisector</B> a value wchich divide fuzzy set on two parts of equal area;
<li><B>min</B> min (right limit) of highest part of the set;
<li><B>mean</B> mean (center) of highest part of the set;
<li><B>max</B> max (left limit) of highest part of the set;
</UL>


<DT><b>universe resolution</b></DT>
<DD>The universe is an interval between the lowest and highest values of fuzzy sets of output map. The resolution provides number of elements of partial fuzzy sets of every rules and final agregated fuzzy set before defuzzyfication. Because it has strong inpact on computation time and precision of deffuzification, values lower than 30 may change final result, but values above 200 radically slow down computation time.

<h2>VISUAL OUTPUT</h2>
<DT><b>coordinates</b></DT>
<DD>Coordinates of points to which output universe, all consequents sets and agregate set. It is useful for visual presentation or detail analysis of fuzzy rules behaviour. In that cases calculations are peroforemd n=only for selected point.

<h2>OUTPUTS</h2>
<DT><b>output</b></DT>
<DD>Map containing deffuzified values. Map is always of type FCELLS and contains values defined in output universe. The output name must be the same as one of maps in maps definition file.</DD>
<P>
<DT><b>multipe output flag</b></DT>
<DD>This flag is used to create fuzzified maps for every rule. The name of the map consist of otput map name, '_' and rule name (for example: output=probs and rule name high, the map name: probs_high). Values of maps ranges from 0  to 1. If map with such name exist will be overwritten without warning.



<h2>DESCRIPTION</h2>
<P>
<H4>Definition of fuzzy set</H4>



<h2>NOTES</H2>
<H4>Calculation of boundary shape</H4>
Depending on type of the boundary different equation are used to determine its shape:
<P>

<B>Linear:</B> the membership is calculated according following equation:<br>

<pre><code>
value  <=  A -> x = 0
A< value > B -> x = (value-A)/(B-A)
B <= value >= C -> x = 1
C< value > D -> x = (D-value)/(D-C)
value  >=  D -> x = 0
</code></pre>
<B>S-shaped, G-shaped and J shaped:</B>  use following equation to sommoth boundary:
<pre><code>
sin(x * Pi/2)^2 (for S-shaped)
tan(x * Pi/4)^2 (for J-shaped)
tan(x * Pi/4)^0.5 (for G-shaped)

where:
x current fuzzy value
A,B,C,D inflection point,
</code></pre>


<h2>EXAMPLE</H2>
<P>
Fuzzy sets are sets whose elements have degrees of membership. Zadeh (1965) introduced Fuzzy sets as an extension of the classical notion of set. Classical  membership of elements in a set are binary terms: an element either belongs or does not belong to the set. Fuzzy set theory use the gradual membership of elements in a set. A membership function use values in the real unit interval [0, 1]. Classical sets, are special cases of the membership functions of fuzzy sets and only take values 0 or 1. Classical sets are in fuzzy set theory usually called crisp sets. The fuzzy set theory can be used in a wide range of domains in which information is  imprecise, such as most of the GIS operations.
<P>
Suppose we want to determine the flood risk on some area (Spearfish dataset) using two maps: distance to streams and elevation above streams. The common sense rules are;
<PRE>
IF elevation IS low AND distance IS near THEN risk IS veryprobable
IF elevation IS low OR distance IS near THEN risk IS probable
IF elevation IS high AND distance IS far THEN risk IS unprobable
</PRE>
In clasical boolean sense, we would taken some limits of ideas "near" "far" etc, but what about walues near the limit? The fuzzy set uses partial memberships which abolish these restrictions. In that sense to set "near" belongs all areas with distance no more than 100 m with full membership and from 100 to 200 m with partial membership grater than 0. Over 200 m we can assume that is not near.
This allow to formulate fuzzy rules for distance map:
<PRE>
near: BELOW 100 = 1; FROM 100 TO 200 = {1 TO 0}; ABOVE 200 = 0;
</PRE>

To recive final map we need to calculate partial fuzzy set for all rules and next agregate it into one fuzzy set. These fuzzy sets are created on value sequence called universe. Every set has the number of elements equal to universe resolution. It cannot be stored as map so it require defuzzification.
<P>
First we need two maps: we can create with r.stream package:

<PRE>
r.stream.extract elevation=elevation.10m@PERMANENT threshold=2000 stream_rast=streams direction=dirs 
r.stream.order stream=streams dir=dirs horton=horton
r.mapcalc "horton3=if(horton>2,horton,null()"
r.stream.distance stream=streams dir=dirs dem=elevation.10m method=downstream distance=distance elevation=elevation 
</PRE>

Next, to perform analysis we need two files: one with definition of map used in analysis and definition of fuzzy sets for every map, and second with fuzzy rules. For this example:

<P>MAPS
<PRE>
#flood.map
	%elevation
$ low {right; 2,6; sshaped; 0; 1}
$ high {left; 2,6; sshaped; 0; 1}
	%distance
$ near {right; 40,80; sshaped; 0; 1}
$ far {left; 40,80; sshaped; 0; 1}
#output map
	%flood
$ unprob {both; 0,20,20,40; linear; 0;1}
$ prob {both; 20,40,40,60; linear; 0;1}
$ veryprob {both; 40,60,60,80; linear; 0;1}

</PRE>
<P>RULES:
<PRE>
#flood.rul
$ unprob {elevation = high & distance = far};
$ prob {distance = near | elevation = low};
$ veryprob {distance = near & elevation = low};
</PRE>

finally we need run r.fuzzy.system:
<PRE>
r.fuzzy.system vars=flood.map rules=flod.rul output=flood 
</PRE>

Resulting map should look like this:
<img src=f_result.png border=1><br>

<h2>SEE ALSO</h2>

<em>
<a href="r.fuzzy.logic.html">r.fuzzy.logic</a>,
<a href="r.fuzzy.set.html">r.fuzzy.set</a>,
<a href="r.mapcalc.html">r.mapcalc</a>,
</em>



<h2>REFERENCES</h2>

Zadeh, L.A. (1965). "Fuzzy sets". Information and Control 8 (3): 338–353. doi:10.1016/S0019-9958(65)90241-X. ISSN 0019-9958.<P>

Novák, Vilém (1989). Fuzzy Sets and Their Applications. Bristol: Adam Hilger. ISBN 0-85274-583-4.<P>

Klir, George J.; Yuan, Bo (1995). Fuzzy sets and fuzzy logic: theory and applications. Upper Saddle River, NJ: Prentice Hall PTR. ISBN 0-13-101171-5.<P>

Klir, George J.; St Clair, Ute H.; Yuan, Bo (1997). Fuzzy set theory: foundations and applications. Englewood Cliffs, NJ: Prentice Hall. ISBN 0133410587.<P>

Meyer D, Hornik K (2009a). \Generalized and Customizable Sets in R." Journal of Statistical Software, 31(2), 1{27. URL http://www.jstatsoft.org/v31/i02/.<P>

Meyer D, Hornik K (2009b). sets: Sets, Generalized Sets, and Customizable Sets. R~package version~1.0, URL http://CRAN.R-project.org/package=sets.<P>

<h2>AUTHOR</h2>
Jarek  Jasiewicz



<h2>SEE ALSO</h2>
<em>
<a href="r.fuzzy.html">r.fuzzy</a>,
<a href="r.mapcalc.html">r.mapcalc</a>,
</em>
<HR>
<P><a href="index.html">Main index</a> - <a href="raster.html">raster index</a> - <a href="full_index.html">Full index</a></P>
<P>&copy; 2003-2009 <a href="http://grass.osgeo.org">GRASS Development Team</a></p>
</body>
</html>
