<h2>DESCRIPTION</h2>

<em>r.stream.extract</em> extracts streams in both raster and vector
format from a required input <em>elevation</em> map and optional input
<em>accumulation map</em>.

<h2>OPTIONS</h2>

<dl>
<dt><em>elevation</em> 

<dd>Input map, required: Elevation on which entire analysis is based.
NULL (nodata) cells are ignored, zero and negative values are valid
elevation data. Gaps in the elevation map that are located within the
area of interest must be filled beforehand, e.g. with
<em>r.fillnulls</em>, to avoid distortions.
<p>
<dt><em>accumulation</em>
<dd>Input map, optional: Accumulation values of the provided
<em>accumulation</em> map are used and not calculated from the input
<em>elevation</em> map. If <em>accumulation</em> is given,
<em>elevation</em> must be exactly the same map used to calculate
<em>accumulation</em>. If <em>accumulation</em> was calculated with
<a href="r.terraflow.html">r.terraflow</a>, the filled elevation output
of r.terraflow must be used. Further on, the current region's resolution
should be identical to the <em>accumulation map</em>. Flow direction is
first calculated from <em>elevation</em> and then adjusted to
<em>accumulation</em>. It is not necessary to provide <em>accumulation</em>
as the number of cells, it can also be (adjusted) total contributing
area in square meters or any other unit. 
<p>
<dt><em>weight</em>
<dd>Input map, optional: Map used as <em>weight</em> for accumulation
values. If local accumulation multiplied by local weight reaches or
exceeds treshold, a new stream is initiated. If both
<em>accumulation</em> and <em>weight</em> are given, memory can be safed
by multiplying accumulation with <em>weight</em> first using
<a href="r.mapcalc.html">r.mapcalc</a>, and then only giving the new
accumulation map as input, <em>weight</em> is now already built in. This
option allows e.g. to decrease the number of streams in dry areas and
increase the number of streams in wet areas by setting <em>weight</em>
to smaller than 1 in dry areas and larger than 1 in wet areas.
<p>
<dt><em>threshold</em>
<dd>Required: <em>threshold</em> for stream initiation by overland flow:
the minumum (optionally modifed) flow accumulation value that will initiate
a new stream. If Montgomery's method for channel initiation is used, the
cell value of the accumulation input map is multiplied by
(tan(local slope))<sup>mexp</sup> and then compared to <em>threshold</em>.
<p>
<dt><em>d8cut</em>
<dd>Minimum amount of overland flow (accumulation) when SFD (D8) will be
used instead of MFD (FD8) to calculate flow accumulation. Only applies
if no accumulation map is provided. Setting to 0 disables MFD completely.
<p>
<dt><em>mexp</em>
<dd>Use the method of Montgomery and Foufoula-Georgiou (1993) to
initiate a stream with exponent <em>mexp</em>. The cell value of the
accumulation input map is multiplied by (tan(local slope))<sup>mexp</sup>
and then compared to <em>threshold</em>. If threshold is reached or
exceeded, a new stream is initiated. The default value 0 disables
Montgomery. Montgomery and Foufoula-Georgiou (1993) generally recommend
to use 2.0 as exponent. <em>mexp</em> values closer to 0 will produce
streams more similar to streams extracted with Montgomery disabled.
Larger <em>mexp</em> values decrease the number of streams in flat areas
and increase the number of streams in steep areas. If <em>weight</em> is
given, the weight is applied first.
<p>
<dt><em>stream_length</em>
<dd>Minimum stream length in number of cells for first-order (head/spring)
stream segments. All first-order stream segments shorter than
<em>stream_length</em> will be deleted.

<p>
<dt><em>stream_rast</em>
<dd>Output raster map with extracted streams. Cell values encode unique
ID for each stream segment.
<p>
<dt><em>stream_vect</em>
<dd>Output vector map with extracted stream segments and points. Points
are written at the start location of each stream segment and at the
outlet of a stream network. In layer 1, categories are unique IDs,
identical to the cell value of the raster output. The attribute table
for layer 1 holds information about the type of stream segment: start
segment, or intermediate segment with tributaries. Columns are cat int,
stream_type varchar(), type_code int. The encoding for type_code is 0 =
start, 1 = intermediate. In layer 2, categories are identical to
type_code in layer 1 with additional category 2 = outlet for outlet
points. Points with category 1 = intermediate in layer 2 are at the
location of confluences.
<p>
<dt><em>direction</em>
<dd>Output raster map with flow direction for all non-NULL cells in
input elevation. Flow direction is of D8 type with a range of 1 to 8.
Multiplying values with 45 gives degrees CCW from East. Flow direction
was adjusted during thinning, taking shortcuts and skipping cells that
were eliminated by the thinning procedure.
</dl>

<h2>NOTES</h2>

<h4>Stream extraction</h4>
If no accumulation input map is provided, flow accumulation is
determined with a hydrological anaylsis similar to
<a href="r.watershed.html">r.watershed</a>. The algorithm is
MFD (FD8) after Holmgren 1994, as for
<a href="r.watershed.html">r.watershed</a>. The <em>threshold</em>
option determines the number of streams and detail of stream networks.
Whenever (optionally weighed) flow accumulation reaches
<em>threshold</em>, a new stream is started and traced downstream to its
outlet point. As for <a href="r.watershed.html">r.watershed</a>,
flow accumulation is calculated as the number of cells draining through
a cell.

<h4>Stream output</h4>
The <em>stream_rast</em> output raster and vector contains stream
segments with unique IDs. Note that these IDs are different from the IDs
assigned by <a href="r.watershed.html">r.watershed</a>. The vector
output also contains points at the location of the start of a stream
segment, at confluences and at stream network outlet locations.
<p>

<h2>SEE ALSO</h2>

<em>
<a href="r.watershed.html">r.watershed</a>,
<a href="r.terraflow.html">r.terraflow</a>,
<a href="r.thin.html">r.thin</a>,
<a href="r.to.vect.html">r.to.vect</a>
</em>

<h2>REFERENCES</h2>
Ehlschlaeger, C. (1989). <i>Using the A<sup>T</sup> Search Algorithm
to Develop Hydrologic Models from Digital Elevation Data</i>,
<b>Proceedings of International Geographic Information Systems (IGIS)
Symposium '89</b>, pp 275-281 (Baltimore, MD, 18-19 March 1989).<br>
URL: <a href="http://faculty.wiu.edu/CR-Ehlschlaeger2/older/IGIS/paper.html">
http://faculty.wiu.edu/CR-Ehlschlaeger2/older/IGIS/paper.html</a>

<p>
Holmgren, P. (1994). <i>Multiple flow direction algorithms for runoff 
modelling in grid based elevation models: An empirical evaluation.</i>
<b>Hydrological Processes</b> Vol 8(4), pp 327-334.<br>
DOI: <a href="http://dx.doi.org/10.1002/hyp.3360080405">10.1002/hyp.3360080405</a>

<p>
Montgomery, D.R., Foufoula-Georgiou, E. (1993). <i>Channel network source
representation using digital elevation models.</i>
<b>Water Resources Research</b> Vol 29(12), pp 3925-3934. 

<h2>AUTHOR</h2>
Markus Metz

<p><i>Last changed: $Date$</i>
